
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Complete documentation for the Common SENSES sensor data pipeline">
      
      
        <meta name="author" content="Juan Cruz">
      
      
      
        <link rel="prev" href="../updating-dashboard/">
      
      
        <link rel="next" href="../sensor-configuration/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>Database Changes - BARI Environmental Sensor Network Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#database-changes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="BARI Environmental Sensor Network Documentation" class="md-header__button md-logo" aria-label="BARI Environmental Sensor Network Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BARI Environmental Sensor Network Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Database Changes
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="BARI Environmental Sensor Network Documentation" class="md-nav__button md-logo" aria-label="BARI Environmental Sensor Network Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    BARI Environmental Sensor Network Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../00-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Understanding the System
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Understanding the System
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-understanding-the-system/architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-understanding-the-system/data-flow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Flow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../01-understanding-the-system/design-decisions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Design Decisions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Working with Data
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Working with Data
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02-working-with-data/quick-start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Database
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Database
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02-working-with-data/database/connecting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Connecting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02-working-with-data/database/understanding-schema/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Understanding the Schema
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02-working-with-data/database/common-queries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Common Queries
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02-working-with-data/database/data-quality/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Data Quality
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Blob Storage
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Blob Storage
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02-working-with-data/blob-storage/accessing-blobs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Accessing Blobs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../02-working-with-data/blob-storage/blob-structure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Blob Structure
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Operating the System
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Operating the System
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03-operating-the-system/daily-checklist/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Daily Checklist
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03-operating-the-system/monitoring-health/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Monitoring Health
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03-operating-the-system/cost-tracking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cost Tracking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03-operating-the-system/sensor-lifecycle/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sensor Lifecycle
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Troubleshooting
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Troubleshooting
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03-operating-the-system/troubleshooting/sensor-not-reporting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sensor Not Reporting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03-operating-the-system/troubleshooting/function-errors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Function Errors
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03-operating-the-system/troubleshooting/database-issues/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Database Issues
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../03-operating-the-system/troubleshooting/dashboard-problems/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Dashboard Problems
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Making Changes
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Making Changes
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../deploying-code-updates/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deploying Code Updates
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../updating-dashboard/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Updating Dashboard
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Database Changes
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Database Changes
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sensor-deployment-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sensor Deployment Management
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sensor Deployment Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-new-sensor-deployments" class="md-nav__link">
    <span class="md-ellipsis">
      
        Adding New Sensor Deployments
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#correcting-deployment-information" class="md-nav__link">
    <span class="md-ellipsis">
      
        Correcting Deployment Information
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quality-issue-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Quality Issue Management
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Quality Issue Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#recording-new-quality-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        Recording New Quality Issues
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resolving-quality-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        Resolving Quality Issues
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#retroactive-data-corrections" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retroactive Data Corrections
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Retroactive Data Corrections">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#updating-deployment_id-for-readings" class="md-nav__link">
    <span class="md-ellipsis">
      
        Updating deployment_id for Readings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flagging-data-after-sensor-uninstall" class="md-nav__link">
    <span class="md-ellipsis">
      
        Flagging Data After Sensor Uninstall
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flagging-data-during-quality-issue-periods" class="md-nav__link">
    <span class="md-ellipsis">
      
        Flagging Data During Quality Issue Periods
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unflagging-data-after-issue-resolution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Unflagging Data After Issue Resolution
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sensor-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sensor Configuration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../infrastructure-changes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Infrastructure Changes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1" >
        
          
          <label class="md-nav__link" for="__nav_7_1" id="__nav_7_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Azure Infrastructure
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Azure Infrastructure
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05-reference/azure-infrastructure/function-apps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Function Apps
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05-reference/azure-infrastructure/sql-database/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SQL Database
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05-reference/azure-infrastructure/blob-storage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Blob Storage
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05-reference/azure-infrastructure/networking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Networking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05-reference/azure-infrastructure/static-web-app/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Static Web App
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05-reference/particle-platform/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Particle Platform
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05-reference/complete-schema/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Complete Schema
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05-reference/function-code-reference/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Function Code Reference
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../05-reference/api-endpoints/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Endpoints
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Appendices
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Appendices
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_1" >
        
          
          <label class="md-nav__link" for="__nav_8_1" id="__nav_8_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Step-by-Step Guides
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Step-by-Step Guides
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../06-appendices/step-by-step-guides/create-sql-database/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Create SQL Database
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../06-appendices/step-by-step-guides/configure-vnet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Configure VNet
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../06-appendices/step-by-step-guides/deploy-function-app/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Deploy Function App
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../06-appendices/sql-query-library/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SQL Query Library
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../06-appendices/error-codes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Error Codes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../06-appendices/contacts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contacts
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sensor-deployment-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sensor Deployment Management
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Sensor Deployment Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-new-sensor-deployments" class="md-nav__link">
    <span class="md-ellipsis">
      
        Adding New Sensor Deployments
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#correcting-deployment-information" class="md-nav__link">
    <span class="md-ellipsis">
      
        Correcting Deployment Information
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#quality-issue-management" class="md-nav__link">
    <span class="md-ellipsis">
      
        Quality Issue Management
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Quality Issue Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#recording-new-quality-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        Recording New Quality Issues
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resolving-quality-issues" class="md-nav__link">
    <span class="md-ellipsis">
      
        Resolving Quality Issues
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#retroactive-data-corrections" class="md-nav__link">
    <span class="md-ellipsis">
      
        Retroactive Data Corrections
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Retroactive Data Corrections">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#updating-deployment_id-for-readings" class="md-nav__link">
    <span class="md-ellipsis">
      
        Updating deployment_id for Readings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flagging-data-after-sensor-uninstall" class="md-nav__link">
    <span class="md-ellipsis">
      
        Flagging Data After Sensor Uninstall
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#flagging-data-during-quality-issue-periods" class="md-nav__link">
    <span class="md-ellipsis">
      
        Flagging Data During Quality Issue Periods
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#unflagging-data-after-issue-resolution" class="md-nav__link">
    <span class="md-ellipsis">
      
        Unflagging Data After Issue Resolution
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="database-changes">Database Changes</h1>
<p>This page covers procedures for modifying existing database records, including sensor deployments, quality issues, and retroactive data corrections.</p>
<p><strong>Prerequisites:</strong> This page assumes you have:</p>
<ul>
<li>Successfully connected to the database (see <a href="../../02-working-with-data/database/connecting/">Connecting to Database</a>)</li>
<li>Write permissions on the database (contact IT if uncertain)</li>
<li>Configured network access if needed (see <a href="../../05-reference/azure-infrastructure/sql-database/#network-access">SQL Database Reference</a>)</li>
<li>A database management tool or programmatic access (see <a href="../../02-working-with-data/database/connecting/#connection-tools">Connection Tools</a>)</li>
</ul>
<p>All queries shown can be executed either through a database manager (Azure Data Studio, SSMS) or programmatically using Python, PowerShell, or other database clients.</p>
<hr />
<h2 id="sensor-deployment-management">Sensor Deployment Management</h2>
<h3 id="adding-new-sensor-deployments">Adding New Sensor Deployments</h3>
<div class="admonition warning">
<p class="admonition-title">Sensor Tracking Spreadsheet</p>
<p>Physical sensor relocations require tracking in both the database and the master sensor tracking spreadsheet maintained by the research team. Before creating a new deployment:</p>
<ol>
<li>Contact the research team for access to the sensor tracking spreadsheet</li>
<li>Update the spreadsheet with the new deployment information (usually done by the research team)</li>
<li>Create the new deployment record in the database following the procedure above</li>
</ol>
<p>This ensures consistency between operational tracking and database records.</p>
</div>
<p>When a sensor is moved to a new location, you need to close the previous deployment and create a new one. This is a two-step process that must be done in order.</p>
<p><strong>Prerequisites:</strong></p>
<ul>
<li>Know the box_id of the sensor being moved</li>
<li>Have the new location details (address, coordinates, coreid)</li>
<li>Have the exact install_datetime for the new location</li>
<li>Have the uninstall_datetime for the previous location</li>
</ul>
<p><strong>Constraints:</strong></p>
<ul>
<li>Only one deployment per box_id can have <code>is_active = 1</code> at a time (enforced by unique index)</li>
<li>The <code>deployment_id</code> is auto-incrementing and cannot be manually assigned</li>
<li>You cannot add a new active deployment if the previous one is still marked <code>is_active = 1</code></li>
</ul>
<p><strong>Procedure:</strong></p>
<p><strong>Step 1: Close the previous deployment</strong></p>
<p>Set the old deployment to inactive and record when it was uninstalled:</p>
<div class="highlight"><pre><span></span><code>```sql
UPDATE nu_sensors
SET 
    is_active = 0,
    uninstall_datetime = &#39;2025-11-07 00:00:00&#39;  -- UTC timestamp when sensor was removed
WHERE box_id = 9 AND is_active = 1;
```
</code></pre></div>
<p><strong>Step 2: Add the new deployment</strong></p>
<p>Insert the new deployment record with the new location details:</p>
<div class="highlight"><pre><span></span><code>```sql
INSERT INTO nu_sensors (box_id, location_id, coreid, location_address, latitude, longitude, install_datetime)
VALUES (
    9,                                    -- Same box_id
    NULL,                                 -- location_id (optional, verify with the research team its value)
    &#39;e00fce68cd4bb76b1b85dbe7&#39;,           -- Particle device coreid
    &#39;Savin &amp; Tupelo&#39;,                     -- New location address
    42.31670,                             -- New latitude
    -71.08095,                            -- New longitude
    &#39;2025-10-31 11:59:00&#39;                 -- UTC timestamp when sensor installed at new location
);
```
</code></pre></div>
<p><strong>Notes:</strong></p>
<ul>
<li>The new record automatically gets the next available <code>deployment_id</code> (you cannot specify it)</li>
<li>The new record defaults to <code>is_active = 1</code> and <code>created_at = GETUTCDATE()</code></li>
<li>If Step 1 fails or is skipped, Step 2 will fail with a unique constraint violation</li>
</ul>
<p><strong>Verification:</strong></p>
<p>Check that the deployment was added correctly:</p>
<div class="highlight"><pre><span></span><code>```sql
SELECT deployment_id, box_id, location_address, install_datetime, is_active
FROM nu_sensors
WHERE box_id = 9
ORDER BY deployment_id DESC;
```
</code></pre></div>
<p>You should see:</p>
<ul>
<li>Old deployment with <code>is_active = 0</code> and <code>uninstall_datetime</code> populated</li>
<li>New deployment with <code>is_active = 1</code> and <code>uninstall_datetime = NULL</code></li>
</ul>
<p><strong>After Adding Deployment:</strong></p>
<p>If data was already recorded under the old deployment_id after the sensor was moved, you'll need to update those readings. See <a href="#updating-deployment_id-for-readings">Updating deployment_id for Readings</a> below.</p>
<hr />
<h3 id="correcting-deployment-information">Correcting Deployment Information</h3>
<p>Use these queries to fix typos or incorrect information in existing deployment records. These updates are for <strong>correcting data entry errors only</strong> - not for recording sensor movements.</p>
<p><strong>Important:</strong> If a sensor has physically moved to a new location, you must create a new deployment record (see <a href="#adding-new-sensor-deployments">Adding New Sensor Deployments</a> above). Do not update the existing deployment's location fields.</p>
<p><strong>Correcting Location Id:</strong></p>
<div class="highlight"><pre><span></span><code>```sql
UPDATE nu_sensors
SET location_id = &#39;Corrected Location Id&#39;
WHERE deployment_id = 10;
```
</code></pre></div>
<p><strong>Correcting Location Address:</strong></p>
<div class="highlight"><pre><span></span><code>```sql
UPDATE nu_sensors
SET location_address = &#39;Corrected Address&#39;
WHERE deployment_id = 10;
```
</code></pre></div>
<p><strong>Correcting Coordinates:</strong></p>
<div class="highlight"><pre><span></span><code>```sql
UPDATE nu_sensors
SET 
    latitude = 42.31234,
    longitude = -71.09876
WHERE deployment_id = 10;
```
</code></pre></div>
<p><strong>Correcting Install Datetime:</strong></p>
<div class="highlight"><pre><span></span><code>```sql
UPDATE nu_sensors
SET install_datetime = &#39;2025-10-31 12:00:00&#39;
WHERE deployment_id = 10;
```
</code></pre></div>
<p><strong>Correcting Particle Core ID:</strong></p>
<div class="highlight"><pre><span></span><code>```sql
UPDATE nu_sensors
SET coreid = &#39;e00fce68cd4bb76b1b85dbe7&#39;
WHERE deployment_id = 10;
```
</code></pre></div>
<hr />
<h2 id="quality-issue-management">Quality Issue Management</h2>
<h3 id="recording-new-quality-issues">Recording New Quality Issues</h3>
<p>When you identify a data quality problem with a sensor, record it in the nu_quality_issues table. This automatically flags future readings from that sensor with <code>quality_ok = 0</code> during Database Writer processing.</p>
<p><strong>Common Issue Types:</strong></p>
<ul>
<li><code>clock_drift</code> - Sensor timestamp significantly off from actual time</li>
<li><code>sensor_malfunction</code> - Hardware reporting implausible or erratic values</li>
<li><code>connectivity</code> - Intermittent communication problems causing data gaps</li>
<li><code>deployment_error</code> - Incorrect metadata or location information</li>
</ul>
<p><strong>Adding a Quality Issue:</strong></p>
<div class="highlight"><pre><span></span><code>```sql
INSERT INTO nu_quality_issues (box_id, start_datetime, issue_type, issue_description)
VALUES (
    19,                                    -- Sensor with the issue
    &#39;2025-11-15 08:00:00&#39;,                 -- UTC timestamp when issue began
    &#39;sensor_malfunction&#39;,                  -- Issue category
    &#39;Temperature readings stuck at 32°F&#39;   -- Detailed description
);
```
</code></pre></div>
<p><strong>Notes:</strong></p>
<ul>
<li>Leave <code>end_datetime</code> as NULL - it will be set when the issue is resolved</li>
<li>The <code>is_resolved</code> column automatically computes to 0 (unresolved)</li>
<li>Future data from this sensor will be flagged with <code>quality_ok = 0</code></li>
<li>Existing data is NOT automatically flagged - see <a href="#flagging-data-during-quality-issue-periods">Flagging Data During Quality Issue Periods</a> for retroactive flagging</li>
</ul>
<p><strong>Writing Clear Descriptions:</strong></p>
<p>Good issue descriptions help researchers understand data quality problems:</p>
<div class="highlight"><pre><span></span><code>```sql
-- Good: Specific and actionable
&#39;Temperature readings consistently 10°F higher than nearby sensors&#39;

-- Good: Clear timeframe context
&#39;No data received after firmware update at 14:30 UTC&#39;

-- Poor: Too vague
&#39;Something wrong with sensor&#39;
```
</code></pre></div>
<hr />
<h3 id="resolving-quality-issues">Resolving Quality Issues</h3>
<p>When a sensor issue is fixed (hardware replaced, firmware updated, etc.), mark the issue as resolved by setting the <code>end_datetime</code>.</p>
<p><strong>Marking an Issue as Resolved:</strong></p>
<div class="highlight"><pre><span></span><code>```sql
UPDATE nu_quality_issues
SET end_datetime = &#39;2025-11-18 12:00:00&#39;  -- UTC timestamp when issue was fixed
WHERE id = 5;
```
</code></pre></div>
<p><strong>Verification:</strong></p>
<p>The <code>is_resolved</code> computed column automatically updates to 1:</p>
<div class="highlight"><pre><span></span><code>```sql
SELECT id, box_id, issue_type, start_datetime, end_datetime, is_resolved
FROM nu_quality_issues
WHERE id = 5;
```
</code></pre></div>
<p>You should see <code>is_resolved = 1</code> and <code>end_datetime</code> populated.</p>
<p><strong>After Resolving:</strong></p>
<ul>
<li>Future readings from this sensor will no longer be automatically flagged</li>
<li>Readings between <code>start_datetime</code> and <code>end_datetime</code> remain flagged with <code>quality_ok = 0</code></li>
<li>If readings after <code>end_datetime</code> were already written with <code>quality_ok = 0</code>, you may need to update them - see <a href="#unflagging-data-after-issue-resolution">Unflagging Data After Issue Resolution</a></li>
</ul>
<hr />
<h2 id="retroactive-data-corrections">Retroactive Data Corrections</h2>
<p>These procedures handle scenarios where database records need updating after data has already been written. Common situations include delayed deployment updates, retroactive quality issue recording, or discovering data problems after the fact.</p>
<div class="admonition warning">
<p class="admonition-title">Test First</p>
<p>Retroactive corrections can affect large numbers of records. Always:</p>
<ol>
<li>Run a SELECT query first to see how many records will be affected</li>
<li>Verify the date ranges and box_id filters are correct</li>
<li>Consider backing up affected data before major updates</li>
<li>Test on a small subset if possible</li>
</ol>
</div>
<h3 id="updating-deployment_id-for-readings">Updating deployment_id for Readings</h3>
<p><strong>Scenario:</strong> You moved a sensor to a new location but didn't add the new deployment record until days later. Readings were written using the old deployment_id, but they actually came from the new location.</p>
<p><strong>Solution:</strong> Update readings to use the correct deployment_id based on the install_datetime.</p>
<p><strong>Step 1: Identify affected readings</strong></p>
<p>Find how many readings need updating:</p>
<div class="highlight"><pre><span></span><code>```sql
SELECT COUNT(*) as affected_readings
FROM nu_readings r
JOIN nu_sensors s_old ON r.deployment_id = s_old.deployment_id
JOIN nu_sensors s_new ON r.box_id = s_new.box_id
WHERE r.box_id = 9
AND s_new.deployment_id = 56  -- New deployment
AND r.timestamp &gt;= s_new.install_datetime  -- Readings after new install
AND r.deployment_id = s_old.deployment_id  -- Still using old deployment
AND s_old.deployment_id != s_new.deployment_id;
```
</code></pre></div>
<p><strong>Step 2: Update the readings</strong></p>
<div class="highlight"><pre><span></span><code>```sql
UPDATE nu_readings
SET deployment_id = 56  -- New deployment_id
WHERE box_id = 9
AND timestamp &gt;= &#39;2025-10-31 11:59:00&#39;  -- install_datetime of new deployment
AND deployment_id = 9;  -- Old deployment_id
```
</code></pre></div>
<p><strong>Example:</strong>
Box 9 moved to new location on Oct 31 at 11:59 UTC (new deployment_id = 45), but the deployment record wasn't added until Nov 5. All readings from Oct 31 - Nov 5 were written with the old deployment_id = 44. This query reassigns those ~7,200 readings to the correct deployment.</p>
<hr />
<h3 id="flagging-data-after-sensor-uninstall">Flagging Data After Sensor Uninstall</h3>
<p><strong>Scenario:</strong> A sensor was uninstalled, but continued transmitting data temporarily (cached readings or delayed shutoff). This "ghost data" should be flagged as unreliable.</p>
<p><strong>Solution:</strong> Flag all readings after uninstall_datetime as quality_ok = 0 for the specific deployment.</p>
<p><strong>Step 1: Identify the deployment and affected readings</strong></p>
<p>First, find the deployment_id for the uninstalled sensor:</p>
<div class="highlight"><pre><span></span><code>```sql
SELECT deployment_id, box_id, location_address, install_datetime, uninstall_datetime
FROM nu_sensors
WHERE box_id = 9
AND uninstall_datetime IS NOT NULL
ORDER BY deployment_id DESC;
```
</code></pre></div>
<p>Then check how many readings are affected:</p>
<div class="highlight"><pre><span></span><code>```sql
SELECT COUNT(*) as readings_after_uninstall
FROM nu_readings r
JOIN nu_sensors s ON r.deployment_id = s.deployment_id
WHERE r.deployment_id = 9  -- Specific deployment that was uninstalled
AND s.uninstall_datetime IS NOT NULL
AND r.timestamp &gt; s.uninstall_datetime
AND r.quality_ok = 1;
```
</code></pre></div>
<p><strong>Step 2: Flag the readings</strong></p>
<div class="highlight"><pre><span></span><code>```sql
UPDATE nu_readings
SET quality_ok = 0
WHERE deployment_id = 9  -- Use specific deployment_id, not box_id
AND timestamp &gt; &#39;2025-11-07 00:00:00&#39;  -- uninstall_datetime from nu_sensors
AND quality_ok = 1;
```
</code></pre></div>
<p><strong>Why use deployment_id:</strong> A box_id can have multiple deployments over time. Using deployment_id ensures you only flag readings from the specific uninstalled deployment, not from earlier or later deployments of the same sensor.</p>
<hr />
<h3 id="flagging-data-during-quality-issue-periods">Flagging Data During Quality Issue Periods</h3>
<p><strong>Scenario:</strong> You discovered a sensor was malfunctioning last week and added a quality issue record today. Readings from last week are already in the database with quality_ok = 1, but should be flagged.</p>
<p><strong>Solution:</strong> Update readings within the quality issue time range to quality_ok = 0.</p>
<p><strong>Step 1: Identify affected readings</strong></p>
<div class="highlight"><pre><span></span><code>```sql
SELECT COUNT(*) as affected_readings
FROM nu_readings r
JOIN nu_quality_issues qi ON r.box_id = qi.box_id
WHERE qi.id = 5  -- Quality issue record ID
AND r.timestamp &gt;= qi.start_datetime
AND (qi.end_datetime IS NULL OR r.timestamp &lt;= qi.end_datetime)
AND r.quality_ok = 1;
```
</code></pre></div>
<p><strong>Step 2: Flag the readings</strong></p>
<div class="highlight"><pre><span></span><code>```sql
UPDATE nu_readings
SET quality_ok = 0
WHERE box_id = 19
AND timestamp &gt;= &#39;2025-11-15 08:00:00&#39;  -- start_datetime from quality issue
AND timestamp &lt;= &#39;2025-11-18 12:00:00&#39;  -- end_datetime from quality issue (or remove this line if ongoing)
AND quality_ok = 1;
```
</code></pre></div>
<hr />
<h3 id="unflagging-data-after-issue-resolution">Unflagging Data After Issue Resolution</h3>
<p><strong>Scenario:</strong> A quality issue was resolved days ago (end_datetime set), but you just ran the Database Writer which flagged new readings because it checked for unresolved issues before you updated end_datetime. Or readings after the resolution were already in the database when you added the quality issue.</p>
<p><strong>Solution:</strong> Set quality_ok = 1 for readings after the issue was resolved.</p>
<p><strong>Step 1: Identify affected readings</strong></p>
<div class="highlight"><pre><span></span><code>```sql
SELECT COUNT(*) as incorrectly_flagged
FROM nu_readings r
JOIN nu_quality_issues qi ON r.box_id = qi.box_id
WHERE qi.id = 5  -- Quality issue that was resolved
AND qi.end_datetime IS NOT NULL  -- Issue is resolved
AND r.timestamp &gt; qi.end_datetime  -- Readings after resolution
AND r.quality_ok = 0;
```
</code></pre></div>
<p><strong>Step 2: Unflag the readings</strong></p>
<div class="highlight"><pre><span></span><code>```sql
UPDATE nu_readings
SET quality_ok = 1
WHERE box_id = 19
AND timestamp &gt; &#39;2025-11-18 12:00:00&#39;  -- end_datetime from quality issue
AND quality_ok = 0;
```
</code></pre></div>
<p><strong>Warning:</strong> This assumes no OTHER quality issues affect this sensor. Check for other active issues:</p>
<div class="highlight"><pre><span></span><code>```sql
SELECT id, issue_type, start_datetime, end_datetime, is_resolved
FROM nu_quality_issues
WHERE box_id = 19
AND id != 5  -- Exclude the issue we just resolved
AND is_resolved = 0;  -- Check for other unresolved issues
```
</code></pre></div>
<p>If other unresolved issues exist for this sensor, unflagging all quality_ok = 0 readings may be incorrect.</p>
<hr />
<!-- ### Schema Modifications

**Adding New Columns**

- Procedures for schema migrations
- Testing changes in development environment
- Deployment to production

**Creating New Indexes**

- When to add indexes
- Testing index performance impact
- Monitoring index usage

### Backup and Rollback

**Before Making Changes**

- Creating manual backups for critical updates
- Testing queries in read-only mode first
- Documenting changes made

**Rolling Back Changes**

- Identifying incorrect updates
- Restoring from backup if needed
- Audit trail considerations -->












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.indexes", "navigation.top", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>